require 'rspec'

expectations = {
    '11' => ['11', '12', '14', '21', '22', '24', '41', '42', '44'],
    '9' => %w(9 8 6),
    '8' => %w(8 0 9 7 5),
    '7' => %w(7 8 4),
    '6' => %w(9 6 5 3),
    '5' => %w(8 6 5 4 2),
    '4' => %w(7 5 4 1),
    '3' => %w(6 3 2),
    '2' => %w(5 3 2 1),
    '1' => %w(4 1 2),
    '369' => ['236', '238', '239', '256', '258', '259', '266', '268', '269', '296', '298', '299', '336', '338', '339', '356', '358', '359', '366', '368', '369', '396', '398', '399', '636', '638', '639', '656', '658', '659', '666', '668', '669', '696', '698', '699'],
    "14290" => ["11160", "11168", "11180", "11188", "11190", "11198", "11260", "11268", "11280", "11288", "11290", "11298", "11360", "11368", "11380", "11388", "11390", "11398", "11560", "11568", "11580", "11588", "11590", "11598", "14160", "14168", "14180", "14188", "14190", "14198", "14260", "14268", "14280", "14288", "14290", "14298", "14360", "14368", "14380", "14388", "14390", "14398", "14560", "14568", "14580", "14588", "14590", "14598", "15160", "15168", "15180", "15188", "15190", "15198", "15260", "15268", "15280", "15288", "15290", "15298", "15360", "15368", "15380", "15388", "15390", "15398", "15560", "15568", "15580", "15588", "15590", "15598", "17160", "17168", "17180", "17188", "17190", "17198", "17260", "17268", "17280", "17288", "17290", "17298", "17360", "17368", "17380", "17388", "17390", "17398", "17560", "17568", "17580", "17588", "17590", "17598", "21160", "21168", "21180", "21188", "21190", "21198", "21260", "21268", "21280", "21288", "21290", "21298", "21360", "21368", "21380", "21388", "21390", "21398", "21560", "21568", "21580", "21588", "21590", "21598", "24160", "24168", "24180", "24188", "24190", "24198", "24260", "24268", "24280", "24288", "24290", "24298", "24360", "24368", "24380", "24388", "24390", "24398", "24560", "24568", "24580", "24588", "24590", "24598", "25160", "25168", "25180", "25188", "25190", "25198", "25260", "25268", "25280", "25288", "25290", "25298", "25360", "25368", "25380", "25388", "25390", "25398", "25560", "25568", "25580", "25588", "25590", "25598", "27160", "27168", "27180", "27188", "27190", "27198", "27260", "27268", "27280", "27288", "27290", "27298", "27360", "27368", "27380", "27388", "27390", "27398", "27560", "27568", "27580", "27588", "27590", "27598", "41160", "41168", "41180", "41188", "41190", "41198", "41260", "41268", "41280", "41288", "41290", "41298", "41360", "41368", "41380", "41388", "41390", "41398", "41560", "41568", "41580", "41588", "41590", "41598", "44160", "44168", "44180", "44188", "44190", "44198", "44260", "44268", "44280", "44288", "44290", "44298", "44360", "44368", "44380", "44388", "44390", "44398", "44560", "44568", "44580", "44588", "44590", "44598", "45160", "45168", "45180", "45188", "45190", "45198", "45260", "45268", "45280", "45288", "45290", "45298", "45360", "45368", "45380", "45388", "45390", "45398", "45560", "45568", "45580", "45588", "45590", "45598", "47160", "47168", "47180", "47188", "47190", "47198", "47260", "47268", "47280", "47288", "47290", "47298", "47360", "47368", "47380", "47388", "47390", "47398", "47560", "47568", "47580", "47588", "47590", "47598"]

}

PIN_CANDIDATES = {'9' => %w(9 8 6),
                  '8' => %w(8 0 9 7 5),
                  '7' => %w(7 8 4),
                  '6' => %w(9 6 5 3),
                  '5' => %w(8 6 5 4 2),
                  '4' => %w(7 5 4 1),
                  '3' => %w(6 3 2),
                  '2' => %w(5 3 2 1),
                  '1' => %w(4 1 2),
                  '0' => %w(0 8)
}

def get_pins(observed)
  total_results = []
  observed.chars.each do |char|
    if total_results.size > 0
      candidate_results = []
      PIN_CANDIDATES[char].size.times { candidate_results << total_results[0] }
      candidate_results
      set_results = []
      PIN_CANDIDATES[char].each_with_index do |digit, idx|
        set = candidate_results[idx]
        result = set.flatten.map { |e| e + digit }
        set_results << result
      end
      total_results = [set_results]
    else
      total_results << PIN_CANDIDATES[char]
    end
  end
  total_results.flatten
end

describe 'The observed PIN case' do
  it 'should return the correct value' do
    expectations.each do |pin, result|
      puts "testing against #{pin}"
      expect(get_pins(pin).sort).to eq result.sort
      puts "******************************passed with pin #{pin}"
    end
  end
end
